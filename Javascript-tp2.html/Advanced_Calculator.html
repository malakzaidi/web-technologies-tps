<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice 4 - Calculatrice Avancée</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        .calculatrice {
            width: 320px;
            background-color: #333;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .ecran {
            background-color: #eaeaea;
            border: none;
            border-radius: 5px;
            height: 60px;
            width: 100%;
            margin-bottom: 15px;
            font-size: 24px;
            text-align: right;
            padding: 5px;
            box-sizing: border-box;
        }
        .boutons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 8px;
        }
        button {
            border: none;
            border-radius: 5px;
            height: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            opacity: 0.9;
        }
        button:active {
            transform: scale(0.98);
        }
        .nombre {
            background-color: #4d4d4d;
            color: white;
        }
        .operateur {
            background-color: #f1a33c;
            color: white;
        }
        .fonction {
            background-color: #2f2f2f;
            color: white;
        }
        .egal {
            background-color: #498de8;
            color: white;
            grid-column: span 2;
        }
        .effacer {
            background-color: #ff4646;
            color: white;
        }
        .historique {
            background-color: #eaeaea;
            border-radius: 5px;
            height: 25px;
            width: 100%;
            margin-bottom: 5px;
            font-size: 14px;
            text-align: right;
            padding: 5px;
            box-sizing: border-box;
            color: #666;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <div class="calculatrice">
        <div class="historique" id="historique"></div>
        <input type="text" class="ecran" id="ecran" readonly>
        <div class="boutons">
            <button class="fonction" onclick="ajouterMemoire()">M+</button>
            <button class="fonction" onclick="rappelMemoire()">MR</button>
            <button class="fonction" onclick="effacerMemoire()">MC</button>
            <button class="effacer" onclick="effacer()">C</button>
            <button class="effacer" onclick="effacerDernier()">CE</button>
            <button class="fonction" onclick="calculerFonction('sqrt')">√</button>
            <button class="fonction" onclick="calculerFonction('square')">x²</button>
            <button class="fonction" onclick="calculerFonction('1/x')">1/x</button>
            <button class="fonction" onclick="calculerFonction('abs')">|x|</button>
            <button class="operateur" onclick="ajouterOperation('/')">/</button>
            <button class="fonction" onclick="calculerFonction('sin')">sin</button>
            <button class="nombre" onclick="ajouterChiffre(7)">7</button>
            <button class="nombre" onclick="ajouterChiffre(8)">8</button>
            <button class="nombre" onclick="ajouterChiffre(9)">9</button>
            <button class="operateur" onclick="ajouterOperation('*')">×</button>
            <button class="fonction" onclick="calculerFonction('cos')">cos</button>
            <button class="nombre" onclick="ajouterChiffre(4)">4</button>
            <button class="nombre" onclick="ajouterChiffre(5)">5</button>
            <button class="nombre" onclick="ajouterChiffre(6)">6</button>
            <button class="operateur" onclick="ajouterOperation('-')">-</button>
            <button class="fonction" onclick="calculerFonction('tan')">tan</button>
            <button class="nombre" onclick="ajouterChiffre(1)">1</button>
            <button class="nombre" onclick="ajouterChiffre(2)">2</button>
            <button class="nombre" onclick="ajouterChiffre(3)">3</button>
            <button class="operateur" onclick="ajouterOperation('+')">+</button>
            <button class="fonction" onclick="calculerFonction('log')">log</button>
            <button class="fonction" onclick="ajouterParenthese('(')">(</button>
            <button class="nombre" onclick="ajouterChiffre(0)">0</button>
            <button class="fonction" onclick="ajouterParenthese(')')">)</button>
            <button class="fonction" onclick="ajouterPoint()">.</button>
            <button class="fonction" onclick="calculerFonction('exp')">exp</button>
            <button class="fonction" onclick="calculerFonction('pi')">π</button>
            <button class="fonction" onclick="changerSigne()">±</button>
            <button class="egal" onclick="calculer()">=</button>
        </div>
    </div>
    
    <script>
        let affichage = "";
        let resultat = null;
        let memoire = 0;
        let dernierCalcul = "";
        const ecran = document.getElementById('ecran');
        const historique = document.getElementById('historique');

        function ajouterChiffre(chiffre) {
            affichage += chiffre;
            mettreAJourEcran();
        }
     
        function ajouterPoint() {
            if (affichage === "" || isNaN(affichage[affichage.length - 1])) {
                affichage += "0.";
            } else if (!affichage.includes('.') || !isNaN(affichage.slice(affichage.lastIndexOf('+') + 1).slice(affichage.lastIndexOf('-') + 1).slice(affichage.lastIndexOf('*') + 1).slice(affichage.lastIndexOf('/') + 1))) {
                affichage += ".";
            }
            mettreAJourEcran();
        }
    
        function ajouterOperation(operation) {
            if (['+', '-', '*', '/'].includes(affichage[affichage.length - 1])) {
                affichage = affichage.slice(0, -1) + operation;
            } else if (affichage !== "") {
                affichage += operation;
            } else if (operation === '-') {
                affichage = operation;
            } else if (resultat !== null) {
                affichage = resultat + operation;
            }
            mettreAJourEcran();
        }
     
        function ajouterParenthese(parenthese) {
            affichage += parenthese;
            mettreAJourEcran();
        }
        function changerSigne() {
            if (affichage !== "") {
                try {
                    let valeur = eval(affichage);
                    affichage = (-valeur).toString();
                    mettreAJourEcran();
                } catch (e) {
                    ecran.value = "Erreur";
                }
            }
        }
    
        function calculer() {
            if (affichage !== "") {
                try {
                   
                    dernierCalcul = affichage;
                    historique.textContent = dernierCalcul + " =";
                
                    resultat = eval(affichage);
                    
                    affichage = resultat.toString();
                    mettreAJourEcran();
                } catch (e) {
                    ecran.value = "Erreur";
                    affichage = "";
                }
            }
        }
        
        function calculerFonction(fonction) {
            try {
                let valeur;
                if (affichage === "" && resultat !== null) {
                    valeur = resultat;
                } else if (affichage !== "") {
                    valeur = eval(affichage);
                } else {
                    valeur = 0;
                }
        e
                switch (fonction) {
                    case 'sqrt':
                        if (valeur < 0) {
                            ecran.value = "Erreur";
                            affichage = "";
                            return;
                        }
                        resultat = Math.sqrt(valeur);
                        dernierCalcul = `sqrt(${valeur})`;
                        break;
                    case 'square':
                        resultat = Math.pow(valeur, 2);
                        dernierCalcul = `(${valeur})²`;
                        break;
                    case '1/x':
                        if (valeur === 0) {
                            ecran.value = "Division par zéro";
                            affichage = "";
                            return;
                        }
                        resultat = 1 / valeur;
                        dernierCalcul = `1/(${valeur})`;
                        break;
                    case 'sin':
                        resultat = Math.sin(valeur);
                        dernierCalcul = `sin(${valeur})`;
                        break;
                    case 'cos':
                        resultat = Math.cos(valeur);
                        dernierCalcul = `cos(${valeur})`;
                        break;
                    case 'tan':
                        resultat = Math.tan(valeur);
                        dernierCalcul = `tan(${valeur})`;
                        break;
                    case 'log':
                        if (valeur <= 0) {
                            ecran.value = "Erreur";
                            affichage = "";
                            return;
                        }
                        resultat = Math.log10(valeur);
                        dernierCalcul = `log(${valeur})`;
                        break;
                    case 'exp':
                        resultat = Math.exp(valeur);
                        dernierCalcul = `exp(${valeur})`;
                        break;
                    case 'abs':
                        resultat = Math.abs(valeur);
                        dernierCalcul = `|${valeur}|`;
                        break;
                    case 'pi':
                        resultat = Math.PI;
                        dernierCalcul = "π";
                        break;
                }
     
                historique.textContent = dernierCalcul + " =";
     
                affichage = resultat.toString();
                mettreAJourEcran();
            } catch (e) {
                ecran.value = "Erreur";
                affichage = "";
            }
        }
    
        function effacer() {
            affichage = "";
            resultat = null;
            historique.textContent = "";
            mettreAJourEcran();
        }
      
        function effacerDernier() {
            affichage = affichage.slice(0, -1);
            mettreAJourEcran();
        }
    
        function ajouterMemoire() {
            try {
                if (affichage !== "") {
                    memoire += eval(affichage);
                    historique.textContent = "M = " + memoire;
                }
            } catch (e) {
                ecran.value = "Erreur";
            }
        }
        
        function rappelMemoire() {
            affichage = memoire.toString();
            mettreAJourEcran();
        }
        
        function effacerMemoire() {
            memoire = 0;
            historique.textContent = "Mémoire effacée";
        }
        
        function mettreAJourEcran() {
            ecran.value = affichage;
        }
    
        mettreAJourEcran();
    </script>
</body>
</html>